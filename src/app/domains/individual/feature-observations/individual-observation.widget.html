<div class="individual-observation-view__title">
  <h2>{{ 'Ph√§nophasen' | translate }}</h2>
  <div class="individual-observation-view__year">
    <mat-select [value]="individualService.composedId(individual$ | async)" (selectionChange)="selectYear($event)">
      @for (year of years$ | async; track year) {
        <mat-option [value]="year.composedId" [attr.data-testid]="year.composedId">{{ year.year }}</mat-option>
      }
    </mat-select>
  </div>
</div>
@for (groupedItem of phenophaseObservationsGroups$ | async; track groupedItem) {
  <div class="individual-observation-view">
    @if ((isEditable$ | async) || groupedItem.hasObservations) {
      <div class="individual-observation-view__phenophase-group">{{ groupedItem.phenophaseGroup.de | translate }}</div>
      @for (item of groupedItem.phenophaseObservations; track item) {
        <div>
          @if ((isEditable$ | async) || item.observation !== null) {
            <div class="individual-observation-view__phenophase">{{ item.phenophase.de | translate }}</div>
            <mat-form-field class="individual-observation-view__form-field">
              <input
                matInput
                [id]="item.phenophase.id"
                [matDatepicker]="fakePicker"
                [value]="item.observation?.date"
                readonly="true"
                data-test-id="observationDate"
              />
              <mat-label translate>{{ item.phenophase.description_de }}</mat-label>
              <mat-datepicker #fakePicker></mat-datepicker>
              @if ((isEditable$ | async) && item.observation === null && item.limits.isEditable) {
                <mat-icon
                  matSuffix
                  class="individual-observation-view__add-phenophase"
                  color="primary"
                  (click)="editPhenophaseDate(item)"
                  data-test-id="addObservationIcon"
                >
                  add_circle</mat-icon
                >
              }
              @if ((isEditable$ | async) && item.observation === null && !item.limits.isEditable) {
                <mat-icon matSuffix class="individual-observation-view__add-phenophase--disabled" color="accent"
                  >add_circle</mat-icon
                >
              }
              @if ((isEditable$ | async) && item.observation !== null) {
                <mat-icon
                  matSuffix
                  color="primary"
                  class="individual-observation-view__edit-phenophase"
                  (click)="editPhenophaseDate(item)"
                  data-test-id="editObservationIcon"
                  >edit</mat-icon
                >
              }
            </mat-form-field>
            @if (item.observation?.comment?.toString(); as comment) {
              <div class="individual-observation-view__detail-sub">
                {{ 'Kommentar' | translate }}: {{ staticComments[comment] | translate }}
              </div>
            }
          }
        </div>
      }
    }
  </div>
}
